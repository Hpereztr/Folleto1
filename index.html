<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¿Necesitas un Salvavidas? - IBRN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;800&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-script {
            font-family: 'Dancing Script', cursive;
        }
        .bg-gradient-custom {
            background: linear-gradient(135deg, #a3d9a5 0%, #2b6cb0 50%, #1a365d 100%);
        }
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .btn-whatsapp {
            background-color: #25D366;
        }
        .btn-whatsapp:hover {
            background-color: #128C7E;
        }
        /* Marco del logo IBRN */
        .logo-container {
            position: relative;
            padding: 10px 0;
            width: 100%;
            max-width: 320px;
        }
        .ibrn-frame {
            border: 2.5px solid #333;
            border-top: none;
            padding: 15px 10px 10px 10px;
            margin-top: 5px;
            position: relative;
        }
        .ibrn-frame::before, .ibrn-frame::after {
            content: "";
            position: absolute;
            top: 0;
            width: 32%;
            height: 2.5px;
            background-color: #333;
        }
        .ibrn-frame::before { left: 0; }
        .ibrn-frame::after { right: 0; }

        /* Estilos para el cargador */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <!-- Contenedor del Folleto -->
    <div class="max-w-md w-full bg-white shadow-2xl rounded-2xl overflow-hidden border border-gray-200 mb-8">
        
        <!-- Cabecera Visual -->
        <div class="bg-gradient-custom h-72 relative flex flex-col items-center justify-center p-6 text-center text-white">
            <div class="absolute top-4 w-1 h-8 bg-white/50 rounded-full"></div>
            
            <h2 class="text-2xl font-light tracking-widest uppercase opacity-90 mb-2">¿Necesitas un</h2>
            <h1 class="text-5xl font-extrabold tracking-tighter text-shadow italic uppercase">Salvavidas?</h1>
            
            <div class="absolute bottom-0 left-0 right-0 flex justify-center translate-y-4">
                <svg width="200" height="150" viewBox="0 0 200 150" fill="none" xmlns="http://www.w3.org/2000/svg" class="opacity-80 drop-shadow-lg text-slate-900">
                    <path d="M100 150C100 150 70 110 60 90C50 70 45 50 60 40C75 30 85 60 90 70C95 80 90 30 105 25C120 20 125 60 120 80C115 100 150 60 160 75C170 90 140 120 130 130C120 140 100 150 100 150Z" fill="currentColor"/>
                </svg>
            </div>
        </div>

        <!-- Mensaje Principal Personalizado -->
        <div class="p-8 bg-slate-900 text-gray-200 text-sm md:text-base leading-relaxed">
            <p class="mb-4 font-light text-justify">
                A veces la vida se siente como un mar agitado: problemas, culpa, ansiedad y miedo nos hunden poco a poco. Intentamos nadar más fuerte, pero nuestras fuerzas no siempre son suficientes.
            </p>
            <p class="mb-4 font-semibold text-blue-300 border-l-2 border-blue-400 pl-4 text-justify">
                La buena noticia es que no estás solo. Dios envió a Jesús para rescatarte, perdonar tus pecados y darte una nueva vida. Él ya extendió su mano hacia ti.
            </p>
            <p class="text-center font-medium">
                No tienes que salvarte por tus propios medios. Solo necesitas tomar el salvavidas y confiar en Él.
            </p>
        </div>

        <!-- SECCIÓN IA GEMINI: Palabra de Aliento -->
        <div class="p-8 bg-blue-50 border-y border-blue-100">
            <h3 class="text-lg font-bold text-blue-900 mb-3 flex items-center gap-2">
                <i class="fa-solid fa-sparkles text-blue-500"></i>
                Recibe una palabra de aliento ✨
            </h3>
            <p class="text-xs text-gray-600 mb-4">¿Cómo te sientes hoy? Escribe algo corto y deja que la IA busque una promesa bíblica para ti.</p>
            
            <div class="relative mb-4">
                <input type="text" id="userInput" placeholder="Ej: Me siento solo, cansado de trabajar..." 
                    class="w-full p-3 pr-10 rounded-xl border border-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm">
            </div>

            <button onclick="generateWord()" id="genBtn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 rounded-xl transition duration-300 flex items-center justify-center gap-2 shadow-md">
                <span>Generar Mensaje ✨</span>
            </button>

            <!-- Resultado de la IA -->
            <div id="aiResponseContainer" class="hidden mt-6 animate-fade-in">
                <div class="p-5 bg-white rounded-2xl border border-blue-100 shadow-sm">
                    <p id="aiText" class="text-sm text-gray-700 italic leading-relaxed mb-4 text-center"></p>
                    <div class="flex flex-col gap-2">
                        <button onclick="speakText()" id="speakBtn" class="flex items-center justify-center gap-2 text-blue-600 text-xs font-bold uppercase tracking-wider bg-blue-50 py-2 rounded-lg hover:bg-blue-100">
                            <i class="fa-solid fa-volume-high"></i> Escuchar Mensaje ✨
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="errorMessage" class="hidden mt-4 text-red-500 text-xs text-center p-2 bg-red-50 rounded-lg"></div>
        </div>

        <!-- Sección de Identidad y Contacto -->
        <div class="p-8 bg-white text-gray-800">
            <div class="flex flex-col items-center mb-10">
                <div class="logo-container">
                    <div class="ibrn-frame text-center">
                        <h2 class="text-[32px] font-black text-[#333] tracking-tighter leading-none mb-1">RESTAURANDO</h2>
                        <div class="flex items-center justify-center gap-2">
                            <span class="font-script text-3xl text-[#0056b3] leading-none">a las naciones</span>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="text-xl font-bold text-blue-900 mb-4 text-center uppercase tracking-wider">Hoy es el día de tu rescate</h3>
            
            <div class="bg-blue-50 p-4 rounded-lg mb-6 border-l-4 border-blue-500 shadow-sm">
                <p class="text-sm italic font-medium text-blue-800">
                    "Vengan a mí todos ustedes que están cansados y agobiados, y yo les daré descanso."
                </p>
                <p class="text-xs text-blue-600 mt-1 text-right">— Mateo 11:28</p>
            </div>

            <div class="space-y-3">
                <a href="https://wa.me/573004974550?text=Hola,%20leí%20el%20mensaje%20del%20salvavidas.%20Me%20gustaría%20conocer%20más%20de%20Jesús%20y%20recibir%20apoyo." target="_blank" class="flex items-center justify-center gap-3 w-full btn-whatsapp text-white font-bold py-3.5 rounded-xl transition duration-300 shadow-lg">
                    <i class="fa-brands fa-whatsapp text-xl"></i>
                    Hablar por WhatsApp
                </a>

                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdpup5Tjs09hW7V31QxfHyzeOETRrola-fPLP-ra_U3nvASZQ/viewform?usp=publish-editor" target="_blank" class="flex items-center justify-center gap-3 w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-3.5 rounded-xl transition duration-300 shadow-lg">
                    <i class="fa-solid fa-file-signature text-lg"></i>
                    Dejar mis datos
                </a>
            </div>
            
            <div class="mt-8 pt-6 border-t border-gray-100 text-center">
                <div class="flex items-center justify-center gap-2 text-blue-600 mb-1">
                    <i class="fa-solid fa-location-dot text-xs"></i>
                    <p class="text-[10px] font-bold uppercase tracking-widest text-gray-500">Donde encontrarnos</p>
                </div>
                <p class="text-sm text-gray-700 font-bold uppercase">Iglesia Bautista Restaurando a las Naciones</p>
                <p class="text-sm text-gray-600">Cl. 9 #37a61, Mesolandia, Malambo</p>
            </div>
        </div>
        
        <div class="bg-gray-50 py-4 text-center text-[10px] text-gray-400 uppercase tracking-widest">
            © 2026 IBRN - Malambo, Atlántico
        </div>
    </div>

    <script>
        const apiKey = "";
        let currentMessage = "";

        async function fetchWithRetry(url, options, maxRetries = 5) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return await response.json();
                } catch (e) {}
                await new Promise(res => setTimeout(res, Math.pow(2, i) * 1000));
            }
            throw new Error("No se pudo conectar con el servicio.");
        }

        async function generateWord() {
            const input = document.getElementById('userInput').value || "necesito esperanza";
            const btn = document.getElementById('genBtn');
            const resContainer = document.getElementById('aiResponseContainer');
            const aiText = document.getElementById('aiText');
            const errorDiv = document.getElementById('errorMessage');

            btn.disabled = true;
            btn.innerHTML = `<span class="loader"></span> Generando...`;
            errorDiv.classList.add('hidden');

            const systemPrompt = "Eres un asistente pastoral de la Iglesia Bautista Restaurando a las Naciones. El usuario te dirá cómo se siente. Responde con un mensaje corto (máximo 250 caracteres), muy cálido, que incluya una promesa bíblica breve o referencia de esperanza cristiana basada en el folleto 'Jesús el Salvavidas'. Usa un tono compasivo.";

            try {
                const result = await fetchWithRetry(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: input }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    }
                );

                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (text) {
                    currentMessage = text;
                    aiText.innerText = text;
                    resContainer.classList.remove('hidden');
                }
            } catch (err) {
                errorDiv.innerText = "Lo sentimos, no pudimos generar el mensaje en este momento. Por favor, intenta más tarde o contáctanos por WhatsApp.";
                errorDiv.classList.remove('hidden');
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>Generar Mensaje ✨</span>`;
            }
        }

        async function speakText() {
            if (!currentMessage) return;
            const btn = document.getElementById('speakBtn');
            const originalContent = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = `<span class="loader"></span> Cargando voz...`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Di con tono cálido y esperanzador: ${currentMessage}` }] }],
                        generationConfig: {
                            responseModalities: ["AUDIO"],
                            speechConfig: {
                                voiceConfig: {
                                    prebuiltVoiceConfig: { voiceName: "Aoede" }
                                }
                            }
                        }
                    })
                });

                const result = await response.json();
                const audioData = result.candidates[0].content.parts[0].inlineData.data;
                const mimeType = result.candidates[0].content.parts[0].inlineData.mimeType;
                const sampleRate = parseInt(mimeType.split('rate=')[1]) || 24000;

                const wavBuffer = pcmToWav(audioData, sampleRate);
                const blob = new Blob([wavBuffer], { type: 'audio/wav' });
                const url = URL.createObjectURL(blob);
                const audio = new Audio(url);
                audio.play();
                
                audio.onended = () => {
                    btn.disabled = false;
                    btn.innerHTML = originalContent;
                };
            } catch (err) {
                btn.disabled = false;
                btn.innerHTML = originalContent;
            }
        }

        function pcmToWav(base64Pcm, sampleRate) {
            const pcmData = Uint8Array.from(atob(base64Pcm), c => c.charCodeAt(0));
            const wavHeader = new ArrayBuffer(44);
            const view = new DataView(wavHeader);

            view.setUint32(0, 0x52494646, false); // "RIFF"
            view.setUint32(4, 36 + pcmData.length, true);
            view.setUint32(8, 0x57415645, false); // "WAVE"
            view.setUint32(12, 0x666d7420, false); // "fmt "
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true); // PCM
            view.setUint16(22, 1, true); // Mono
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            view.setUint32(36, 0x64617461, false); // "data"
            view.setUint32(40, pcmData.length, true);

            const combined = new Uint8Array(wavHeader.byteLength + pcmData.byteLength);
            combined.set(new Uint8Array(wavHeader), 0);
            combined.set(pcmData, wavHeader.byteLength);
            return combined.buffer;
        }
    </script>
</body>
</html>